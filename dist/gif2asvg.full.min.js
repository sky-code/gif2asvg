function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e){"use strict";e.__isNode="undefined"==typeof window}("undefined"==typeof window?global:window),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SuperGif=t()}(this,function(){var e=function(e){return e.reduce(function(e,t){return 2*e+t},0)},t=function(e){for(var t=[],n=7;n>=0;n--)t.push(!!(e&1<<n));return t},n=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],n=0;e>n;n++)t.push(this.readByte());return t},this.read=function(e){for(var t="",n=0;e>n;n++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},i=function(e,t){for(var n,i,r=0,a=function(e){for(var n=0,i=0;e>i;i++)t.charCodeAt(r>>3)&1<<(7&r)&&(n|=1<<i),r++;return n},o=[],s=1<<e,l=s+1,u=e+1,d=[],h=function(){d=[],u=e+1;for(var t=0;s>t;t++)d[t]=[t];d[s]=[],d[l]=null};;)if(i=n,n=a(u),n!==s){if(n===l)break;if(n<d.length)i!==s&&d.push(d[i].concat(d[n][0]));else{if(n!==d.length)throw new Error("Invalid LZW code.");d.push(d[i].concat(d[i][0]))}o.push.apply(o,d[n]),d.length===1<<u&&12>u&&u++}else h();return o},r=function(n,r){r||(r={});var a=function(e){for(var t=[],i=0;e>i;i++)t.push(n.readBytes(3));return t},o=function(){var e,t;t="";do e=n.readByte(),t+=n.read(e);while(0!==e);return t},s=function(){var i={};if(i.sig=n.read(3),i.ver=n.read(3),"GIF"!==i.sig)throw new Error("Not a GIF file.");i.width=n.readUnsigned(),i.height=n.readUnsigned();var o=t(n.readByte());i.gctFlag=o.shift(),i.colorRes=e(o.splice(0,3)),i.sorted=o.shift(),i.gctSize=e(o.splice(0,3)),i.bgColor=n.readByte(),i.pixelAspectRatio=n.readByte(),i.gctFlag&&(i.gct=a(1<<i.gctSize+1)),r.hdr&&r.hdr(i)},l=function(i){var a=function(i){var a=(n.readByte(),t(n.readByte()));i.reserved=a.splice(0,3),i.disposalMethod=e(a.splice(0,3)),i.userInput=a.shift(),i.transparencyGiven=a.shift(),i.delayTime=n.readUnsigned(),i.transparencyIndex=n.readByte(),i.terminator=n.readByte(),r.gce&&r.gce(i)},s=function(e){e.comment=o(),r.com&&r.com(e)},l=function(e){n.readByte();e.ptHeader=n.readBytes(12),e.ptData=o(),r.pte&&r.pte(e)},u=function(e){{var t=function(e){n.readByte();e.unknown=n.readByte(),e.iterations=n.readUnsigned(),e.terminator=n.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(e)},i=function(e){e.appData=o(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)};n.readByte()}switch(e.identifier=n.read(8),e.authCode=n.read(3),e.identifier){case"NETSCAPE":t(e);break;default:i(e)}},d=function(e){e.data=o(),r.unknown&&r.unknown(e)};switch(i.label=n.readByte(),i.label){case 249:i.extType="gce",a(i);break;case 254:i.extType="com",s(i);break;case 1:i.extType="pte",l(i);break;case 255:i.extType="app",u(i);break;default:i.extType="unknown",d(i)}},u=function(s){var l=function(e,t){for(var n=new Array(e.length),i=e.length/t,r=function(i,r){var a=e.slice(r*t,(r+1)*t);n.splice.apply(n,[i*t,t].concat(a))},a=[0,4,2,1],o=[8,8,4,2],s=0,l=0;4>l;l++)for(var u=a[l];i>u;u+=o[l])r(u,s),s++;return n};s.leftPos=n.readUnsigned(),s.topPos=n.readUnsigned(),s.width=n.readUnsigned(),s.height=n.readUnsigned();var u=t(n.readByte());s.lctFlag=u.shift(),s.interlaced=u.shift(),s.sorted=u.shift(),s.reserved=u.splice(0,2),s.lctSize=e(u.splice(0,3)),s.lctFlag&&(s.lct=a(1<<s.lctSize+1)),s.lzwMinCodeSize=n.readByte();var d=o();s.pixels=i(s.lzwMinCodeSize,d),s.interlaced&&(s.pixels=l(s.pixels,s.width)),r.img&&r.img(s)},d=function(){var e={};switch(e.sentinel=n.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",l(e);break;case",":e.type="img",u(e);break;case";":e.type="eof",r.eof&&r.eof(e);break;default:throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}"eof"!==e.type&&setTimeout(d,0)},h=function(){s(),setTimeout(d,0)};h()},a=function(e){var t={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var i in e)t[i]=e[i];t.vp_w&&t.vp_h&&(t.is_vp=!0);var a,o,s=null,l=!1,u=null,d=null,h=null,c=null,f=null,g=null,p=null,v=!0,m=!0,y=!1,w=[],_=[],b=t.gif;"undefined"==typeof t.auto_play&&(t.auto_play=!b.getAttribute("rel:auto_play")||"1"==b.getAttribute("rel:auto_play"));var x,A,k,C,S=t.hasOwnProperty("on_end")?t.on_end:null,B=t.hasOwnProperty("loop_delay")?t.loop_delay:0,I=t.hasOwnProperty("loop_mode")?t.loop_mode:"auto",T=t.hasOwnProperty("draw_while_loading")?t.draw_while_loading:!0,F=T?t.hasOwnProperty("show_progress_bar")?t.show_progress_bar:!0:!1,P=t.hasOwnProperty("progressbar_height")?t.progressbar_height:25,E=t.hasOwnProperty("progressbar_background_color")?t.progressbar_background_color:"rgba(255,255,255,0.4)",U=t.hasOwnProperty("progressbar_foreground_color")?t.progressbar_foreground_color:"rgba(255,0,22,.8)",D=function(){u=null,d=null,f=h,h=null,g=null},N=function(){try{r(a,X)}catch(e){O("parse")}},z=function(e,t){x.width=e*J(),x.height=t*J(),k.style.minWidth=e*J()+"px",C.width=e,C.height=t,C.style.width=e+"px",C.style.height=t+"px",C.getContext("2d").setTransform(1,0,0,1,0,0)},G=function(e,t){return _[e]?("undefined"!=typeof t.x&&(_[e].x=t.x),void("undefined"!=typeof t.y&&(_[e].y=t.y))):void(_[e]=t)},R=function(e,n,i){if(i&&F){var r,a,o,s,l=P;if(t.is_vp){y?(o=(t.vp_t+t.vp_h-l)/J(),l/=J(),r=t.vp_l/J(),a=r+e/n*(t.vp_w/J()),s=x.width/J()):(o=t.vp_t+t.vp_h-l,l=l,r=t.vp_l,a=r+e/n*t.vp_w,s=x.width)}else o=(x.height-l)/(y?J():1),a=e/n*x.width/(y?J():1),s=x.width/(y?J():1),l/=y?J():1;A.fillStyle=E,A.fillRect(a,o,s-a,l),A.fillStyle=U,A.fillRect(0,o,a,l)}},O=function(e){var n=function(){A.fillStyle="black",A.fillRect(0,0,t.c_w?t.c_w:o.width,t.c_h?t.c_h:o.height),A.strokeStyle="red",A.lineWidth=3,A.moveTo(0,0),A.lineTo(t.c_w?t.c_w:o.width,t.c_h?t.c_h:o.height),A.moveTo(0,t.c_h?t.c_h:o.height),A.lineTo(t.c_w?t.c_w:o.width,0),A.stroke()};s=e,o={width:b.width,height:b.height},w=[],n()},W=function(e){o=e,z(o.width,o.height)},q=function(e){M(),D(),u=e.transparencyGiven?e.transparencyIndex:null,d=e.delayTime,h=e.disposalMethod},M=function(){g&&(w.push({data:g.getImageData(0,0,o.width,o.height),delay:d}),_.push({x:0,y:0}))},H=function(e){g||(g=C.getContext("2d"));var n=w.length,i=e.lctFlag?e.lct:o.gct;n>0&&(3===f?null!==c?g.putImageData(w[c].data,0,0):g.clearRect(p.leftPos,p.topPos,p.width,p.height):c=n-1,2===f&&g.clearRect(p.leftPos,p.topPos,p.width,p.height));var r=g.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(function(e,t){e!==u&&(r.data[4*t+0]=i[e][0],r.data[4*t+1]=i[e][1],r.data[4*t+2]=i[e][2],r.data[4*t+3]=255)}),g.putImageData(r,e.leftPos,e.topPos),y||(A.scale(J(),J()),y=!0),T&&(A.drawImage(C,0,0),T=t.auto_play),p=e},j=function(){var e=-1,n=0,i=function(){var t=m?1:-1;return(e+t+w.length)%w.length},r=function(t){e+=t,o()},a=function(){var t=!1,a=function(){null!==S&&S(b),n++,I!==!1||0>n?o():(t=!1,v=!1)},o=function(){if(t=v){r(1);var n=10*w[e].delay;n||(n=100);var s=i();0===s?(n+=B,setTimeout(a,n)):setTimeout(o,n)}};return function(){t||setTimeout(o,0)}}(),o=function(){var t;e=parseInt(e,10),e>w.length-1&&(e=0),0>e&&(e=0),t=_[e],C.getContext("2d").putImageData(w[e].data,t.x,t.y),A.globalCompositeOperation="copy",A.drawImage(C,0,0)},l=function(){v=!0,a()},u=function(){v=!1};return{init:function(){s||(t.c_w&&t.c_h||A.scale(J(),J()),t.auto_play?a():(e=0,o()))},step:a,play:l,pause:u,playing:v,move_relative:r,current_frame:function(){return e},frames:function(){return w},length:function(){return w.length},move_to:function(t){e=t,o()}}}(),K=function(e){R(a.pos,a.data.length,e)},L=function(){},V=function(e,t){return function(n){e(n),K(t)}},X={hdr:V(W),gce:V(q),com:V(L),app:{NETSCAPE:V(L)},img:V(H,!0),eof:function(e){M(),K(!1),t.c_w&&t.c_h||(x.width=o.width*J(),x.height=o.height*J()),j.init(),l=!1,Y&&Y(b)}},Z=function(){var e=b.parentNode,n=document.createElement("div");x=document.createElement("canvas"),A=x.getContext("2d"),k=document.createElement("div"),C=document.createElement("canvas"),n.width=x.width=b.width,n.height=x.height=b.height,k.style.minWidth=b.width+"px",n.className="jsgif",k.className="jsgif_toolbar",n.appendChild(x),n.appendChild(k),e.insertBefore(n,b),e.removeChild(b),t.c_w&&t.c_h&&z(t.c_w,t.c_h),Q=!0},J=function(){var e;return e=t.max_width&&o&&o.width>t.max_width?t.max_width/o.width:1},Q=!1,Y=!1,$=function(e){return l?!1:(Y=e?e:!1,l=!0,w=[],D(),c=null,f=null,g=null,p=null,!0)};return{play:j.play,pause:j.pause,move_relative:j.move_relative,move_to:j.move_to,get_playing:function(){return j.playing},get_canvas:function(){return x},get_canvas_scale:function(){return J()},get_loading:function(){return l},get_auto_play:function(){return t.auto_play},get_frames:function(){return j.frames()},get_length:function(){return j.length()},get_current_frame:function(){return j.current_frame()},load_url:function(e,t){if($(t)){var i=new XMLHttpRequest;i.open("GET",e,!0),"overrideMimeType"in i?i.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in i?i.responseType="arraybuffer":i.setRequestHeader("Accept-Charset","x-user-defined"),i.onloadstart=function(){Q||Z()},i.onload=function(e){200!=this.status&&O("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var t=this.response;t.toString().indexOf("ArrayBuffer")>0&&(t=new Uint8Array(t)),a=new n(t),setTimeout(N,0)},i.onprogress=function(e){e.lengthComputable&&R(e.loaded,e.total,!0)},i.onerror=function(){O("xhr")},i.send()}},load:function(e){this.load_url(b.getAttribute("rel:animated_src")||b.src,e)},load_raw:function(e,t){$(t)&&(Q||Z(),a=new n(e),setTimeout(N,0))},set_frame_offset:G}};return a});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e){"use strict";var t=e.SuperGif,n=e.btoa;e.__isNode&&(t=require("../libgif"),n=require("btoa"));var i=function(){function e(){_classCallCheck(this,e),this.isNode="undefined"==typeof window,this.q='"'}return _createClass(e,[{key:"convertDataURIToBinary",value:function(e){for(var t=";base64,",n=e.indexOf(t)+t.length,i=e.substring(n),r=window.atob(i),a=r.length,o=new Uint8Array(new ArrayBuffer(a)),s=0;a>s;s++)o[s]=r.charCodeAt(s);return o}},{key:"convertBinaryToBase64",value:function(e){for(var t,i=32768,r=0,a=e.length,o="";a>r;)t=e.subarray(r,Math.min(r+i,a)),o+=String.fromCharCode.apply(null,t),r+=i;return n(o)}},{key:"encodeSvgAsBase64",value:function(e){return"data:image/svg+xml;base64,"+n(e)}},{key:"wrapInSvgHeader",value:function(e,t,n){var i=this.q,r="<svg xmlns="+i+"http://www.w3.org/2000/svg"+i+" xmlns:A="+i+"http://www.w3.org/1999/xlink"+i+" width="+i+t+i+" height="+i+n+i+">",a="</svg>";return r+e+a}},{key:"_getWebFrames",value:function(e,n){var i=document.createElement("div"),r=document.createElement("img");i.appendChild(r);var a=t({gif:r,auto_play:!1,draw_while_loading:!1,show_progress_bar:!1});a.load_raw(e,function(){var e=a.get_canvas(),t=a.get_frames(),i=[];i.width=e.width,i.height=e.height,i.duration=0;for(var r=0;r<t.length;r++){var o=t[r];a.move_to(r);var s=e.toDataURL("image/png"),l=o.delay;l&&(l=10*l),i.duration+=l,i.push({imageDataUrl:s,delay:l})}n&&n(i)})}},{key:"smilSvgAnimationFromBase64Gif",value:function(e,t){return this.smilSvgAnimationFromImageDataGif(this.convertDataURIToBinary(e),t)}},{key:"smilSvgAnimationFromImageDataGif",value:function(e,t){var n=this;return this._getWebFrames(e,function(e){var i=n.smilSvgAnimationFromWebFrames(e);t&&t(i)}),""}},{key:"cssSvgAnimationFromBase64Gif",value:function(e,t){return this.cssSvgAnimationFromImageDataGif(this.convertDataURIToBinary(e),t)}},{key:"cssSvgAnimationFromImageDataGif",value:function(e,t){var n=this;return this._getWebFrames(e,function(e){var i=n.cssSvgAnimationFromWebFrames(e);t&&t(i)}),""}},{key:"generateImageId",value:function(e,t){return"F"+t}},{key:"generateAnimationId",value:function(e,t){return"A"+t}},{key:"_normalizeKeyFramePercentage",value:function(e){return 0>=e?"0":e>=100?"100":e.toPrecision(e.toString().length>5?4:3)}},{key:"cssSvgAnimationFromWebFrames",value:function(e){for(var t=this.q,n=0,i="",r='<style type="text/css"><![CDATA[',a=e.duration,o=0,s=0;s<e.length;s++){var l=e[s],u=l.imageDataUrl,d=this.generateAnimationId(l,s),h=this.generateImageId(l,s),c="hidden";s===n&&(c="visible");var f="<image id="+t+h+t+" width="+t+e.width+t+" height="+t+e.height+t+" style="+t+"visibility: "+c+";animation:"+d+" "+a+"ms linear 0s infinite;-webkit-animation:"+d+" "+a+"ms linear 0s infinite;"+t+" A:href="+t+u+t+"/>",g="@keyframes "+d+" { ";if(0===s)g+="0% {visibility: visible;}";else{g+="0% {visibility: hidden;}";var p=o/a*100,v=p-.01;v=this._normalizeKeyFramePercentage(v),p=this._normalizeKeyFramePercentage(p),g+=v+"% {visibility: hidden;}",g+=p+"% {visibility: visible;}"}if(o+=l.delay,s===e.length-1)g+="99.99% {visibility: visible;}";else{var m=o/a*100,y=m-.01;m=this._normalizeKeyFramePercentage(m),y=this._normalizeKeyFramePercentage(y),g+=y+"% {visibility: visible;}",g+=m+"% {visibility: hidden;}"}g+="100% {visibility: hidden;}",g+=" }",r+="\n",r+=g,r+="\n",r+="@-webkit-keyframes"+g.slice(10),i+=f}return r+="\n]]></style>",i=r+i,i=this.wrapInSvgHeader(i,e.width,e.height)}},{key:"smilSvgAnimationFromWebFrames",value:function(e){for(var t=this.q,n="",i="",r=0;r<e.length;r++){var a=e[r],o=a.imageDataUrl,s=this.generateImageId(a,r),l="<image id="+t+s+t+" height="+t+"100%"+t+" width="+t+"0"+t+" A:href="+t+o+t+"/>",u=this.generateAnimationId(a,r),d="";d+=0===r?this.generateAnimationId(a,e.length-1)+".end; 0s":this.generateAnimationId(a,r-1)+".end;";var h="<set id="+t+u+t+" A:href="+t+"#"+s+t+" attributeName="+t+"width"+t+" to="+t+"100%"+t+" dur="+t+a.delay+"ms"+t+" begin="+t+d+t+"/>";i+=h,n+=l}return n+=i,n=this.wrapInSvgHeader(n,e.width,e.height)}}]),e}();e.__isNode?module.exports=i:e.gif2asvg=i}("undefined"==typeof window?global:window),function(e){"use strict";var t;t=e.__isNode?require("./dist/gif2asvg"):e.gif2asvg,t.prototype.wrapInSvgHeader=function(e,t,n){var i=this.q,r='<svg id="ts0000000000000000" xmlns='+i+"http://www.w3.org/2000/svg"+i+" xmlns:A="+i+"http://www.w3.org/1999/xlink"+i+" width="+i+t+i+" height="+i+n+i+">",a="</svg>";return r+e+a}}("undefined"==typeof window?global:window);
//# sourceMappingURL=gif2asvg.full.min.js.map
