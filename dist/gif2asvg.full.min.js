function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e){"use strict";e.__isNode="undefined"==typeof window}("undefined"==typeof window?global:window),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SuperGif=t()}(this,function(){var e=function(e){return e.reduce(function(e,t){return 2*e+t},0)},t=function(e){for(var t=[],n=7;n>=0;n--)t.push(!!(e&1<<n));return t},n=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],n=0;e>n;n++)t.push(this.readByte());return t},this.read=function(e){for(var t="",n=0;e>n;n++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},a=function(e,t){for(var n,a,r=0,i=function(e){for(var n=0,a=0;e>a;a++)t.charCodeAt(r>>3)&1<<(7&r)&&(n|=1<<a),r++;return n},o=[],s=1<<e,d=s+1,u=e+1,l=[],h=function(){l=[],u=e+1;for(var t=0;s>t;t++)l[t]=[t];l[s]=[],l[d]=null};;)if(a=n,n=i(u),n!==s){if(n===d)break;if(n<l.length)a!==s&&l.push(l[a].concat(l[n][0]));else{if(n!==l.length)throw new Error("Invalid LZW code.");l.push(l[a].concat(l[a][0]))}o.push.apply(o,l[n]),l.length===1<<u&&12>u&&u++}else h();return o},r=function(n,r){r||(r={});var i=function(e){for(var t=[],a=0;e>a;a++)t.push(n.readBytes(3));return t},o=function(){var e,t;t="";do e=n.readByte(),t+=n.read(e);while(0!==e);return t},s=function(){var a={};if(a.sig=n.read(3),a.ver=n.read(3),"GIF"!==a.sig)throw new Error("Not a GIF file.");a.width=n.readUnsigned(),a.height=n.readUnsigned();var o=t(n.readByte());a.gctFlag=o.shift(),a.colorRes=e(o.splice(0,3)),a.sorted=o.shift(),a.gctSize=e(o.splice(0,3)),a.bgColor=n.readByte(),a.pixelAspectRatio=n.readByte(),a.gctFlag&&(a.gct=i(1<<a.gctSize+1)),r.hdr&&r.hdr(a)},d=function(a){var i=function(a){var i=(n.readByte(),t(n.readByte()));a.reserved=i.splice(0,3),a.disposalMethod=e(i.splice(0,3)),a.userInput=i.shift(),a.transparencyGiven=i.shift(),a.delayTime=n.readUnsigned(),a.transparencyIndex=n.readByte(),a.terminator=n.readByte(),r.gce&&r.gce(a)},s=function(e){e.comment=o(),r.com&&r.com(e)},d=function(e){n.readByte();e.ptHeader=n.readBytes(12),e.ptData=o(),r.pte&&r.pte(e)},u=function(e){{var t=function(e){n.readByte();e.unknown=n.readByte(),e.iterations=n.readUnsigned(),e.terminator=n.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(e)},a=function(e){e.appData=o(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)};n.readByte()}switch(e.identifier=n.read(8),e.authCode=n.read(3),e.identifier){case"NETSCAPE":t(e);break;default:a(e)}},l=function(e){e.data=o(),r.unknown&&r.unknown(e)};switch(a.label=n.readByte(),a.label){case 249:a.extType="gce",i(a);break;case 254:a.extType="com",s(a);break;case 1:a.extType="pte",d(a);break;case 255:a.extType="app",u(a);break;default:a.extType="unknown",l(a)}},u=function(s){var d=function(e,t){for(var n=new Array(e.length),a=e.length/t,r=function(a,r){var i=e.slice(r*t,(r+1)*t);n.splice.apply(n,[a*t,t].concat(i))},i=[0,4,2,1],o=[8,8,4,2],s=0,d=0;4>d;d++)for(var u=i[d];a>u;u+=o[d])r(u,s),s++;return n};s.leftPos=n.readUnsigned(),s.topPos=n.readUnsigned(),s.width=n.readUnsigned(),s.height=n.readUnsigned();var u=t(n.readByte());s.lctFlag=u.shift(),s.interlaced=u.shift(),s.sorted=u.shift(),s.reserved=u.splice(0,2),s.lctSize=e(u.splice(0,3)),s.lctFlag&&(s.lct=i(1<<s.lctSize+1)),s.lzwMinCodeSize=n.readByte();var l=o();s.pixels=a(s.lzwMinCodeSize,l),s.interlaced&&(s.pixels=d(s.pixels,s.width)),r.img&&r.img(s)},l=function(){var e={};switch(e.sentinel=n.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",d(e);break;case",":e.type="img",u(e);break;case";":e.type="eof",r.eof&&r.eof(e);break;default:throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}"eof"!==e.type&&setTimeout(l,0)},h=function(){s(),setTimeout(l,0)};h()},i=function(e){var t={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var a in e)t[a]=e[a];t.vp_w&&t.vp_h&&(t.is_vp=!0);var i,o,s=null,d=!1,u=null,l=null,h=null,c=null,f=null,g=null,p=null,m=!0,v=!0,w=!1,y=[],_=[],b=t.gif;"undefined"==typeof t.auto_play&&(t.auto_play=!b.getAttribute("rel:auto_play")||"1"==b.getAttribute("rel:auto_play"));var I,x,A,T,C=t.hasOwnProperty("on_end")?t.on_end:null,k=t.hasOwnProperty("loop_delay")?t.loop_delay:0,B=t.hasOwnProperty("loop_mode")?t.loop_mode:"auto",S=t.hasOwnProperty("draw_while_loading")?t.draw_while_loading:!0,q=S?t.hasOwnProperty("show_progress_bar")?t.show_progress_bar:!0:!1,P=t.hasOwnProperty("progressbar_height")?t.progressbar_height:25,D=t.hasOwnProperty("progressbar_background_color")?t.progressbar_background_color:"rgba(255,255,255,0.4)",$=t.hasOwnProperty("progressbar_foreground_color")?t.progressbar_foreground_color:"rgba(255,0,22,.8)",E=function(){u=null,l=null,f=h,h=null,g=null},F=function(){try{r(i,V)}catch(e){R("parse")}},U=function(e,t){I.width=e*Z(),I.height=t*Z(),A.style.minWidth=e*Z()+"px",T.width=e,T.height=t,T.style.width=e+"px",T.style.height=t+"px",T.getContext("2d").setTransform(1,0,0,1,0,0)},N=function(e,t){return _[e]?("undefined"!=typeof t.x&&(_[e].x=t.x),void("undefined"!=typeof t.y&&(_[e].y=t.y))):void(_[e]=t)},G=function(e,n,a){if(a&&q){var r,i,o,s,d=P;if(t.is_vp){w?(o=(t.vp_t+t.vp_h-d)/Z(),d/=Z(),r=t.vp_l/Z(),i=r+e/n*(t.vp_w/Z()),s=I.width/Z()):(o=t.vp_t+t.vp_h-d,d=d,r=t.vp_l,i=r+e/n*t.vp_w,s=I.width)}else o=(I.height-d)/(w?Z():1),i=e/n*I.width/(w?Z():1),s=I.width/(w?Z():1),d/=w?Z():1;x.fillStyle=D,x.fillRect(i,o,s-i,d),x.fillStyle=$,x.fillRect(0,o,i,d)}},R=function(e){var n=function(){x.fillStyle="black",x.fillRect(0,0,t.c_w?t.c_w:o.width,t.c_h?t.c_h:o.height),x.strokeStyle="red",x.lineWidth=3,x.moveTo(0,0),x.lineTo(t.c_w?t.c_w:o.width,t.c_h?t.c_h:o.height),x.moveTo(0,t.c_h?t.c_h:o.height),x.lineTo(t.c_w?t.c_w:o.width,0),x.stroke()};s=e,o={width:b.width,height:b.height},y=[],n()},O=function(e){o=e,U(o.width,o.height)},z=function(e){M(),E(),u=e.transparencyGiven?e.transparencyIndex:null,l=e.delayTime,h=e.disposalMethod},M=function(){g&&(y.push({data:g.getImageData(0,0,o.width,o.height),delay:l}),_.push({x:0,y:0}))},H=function(e){g||(g=T.getContext("2d"));var n=y.length,a=e.lctFlag?e.lct:o.gct;n>0&&(3===f?null!==c?g.putImageData(y[c].data,0,0):g.clearRect(p.leftPos,p.topPos,p.width,p.height):c=n-1,2===f&&g.clearRect(p.leftPos,p.topPos,p.width,p.height));var r=g.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(function(e,t){e!==u&&(r.data[4*t+0]=a[e][0],r.data[4*t+1]=a[e][1],r.data[4*t+2]=a[e][2],r.data[4*t+3]=255)}),g.putImageData(r,e.leftPos,e.topPos),w||(x.scale(Z(),Z()),w=!0),S&&(x.drawImage(T,0,0),S=t.auto_play),p=e},j=function(){var e=-1,n=0,a=function(){var t=v?1:-1;return(e+t+y.length)%y.length},r=function(t){e+=t,o()},i=function(){var t=!1,i=function(){null!==C&&C(b),n++,B!==!1||0>n?o():(t=!1,m=!1)},o=function(){if(t=m){r(1);var n=10*y[e].delay;n||(n=100);var s=a();0===s?(n+=k,setTimeout(i,n)):setTimeout(o,n)}};return function(){t||setTimeout(o,0)}}(),o=function(){var t;e=parseInt(e,10),e>y.length-1&&(e=0),0>e&&(e=0),t=_[e],T.getContext("2d").putImageData(y[e].data,t.x,t.y),x.globalCompositeOperation="copy",x.drawImage(T,0,0)},d=function(){m=!0,i()},u=function(){m=!1};return{init:function(){s||(t.c_w&&t.c_h||x.scale(Z(),Z()),t.auto_play?i():(e=0,o()))},step:i,play:d,pause:u,playing:m,move_relative:r,current_frame:function(){return e},frames:function(){return y},length:function(){return y.length},move_to:function(t){e=t,o()}}}(),W=function(e){G(i.pos,i.data.length,e)},L=function(){},J=function(e,t){return function(n){e(n),W(t)}},V={hdr:J(O),gce:J(z),com:J(L),app:{NETSCAPE:J(L)},img:J(H,!0),eof:function(e){M(),W(!1),t.c_w&&t.c_h||(I.width=o.width*Z(),I.height=o.height*Z()),j.init(),d=!1,Q&&Q(b)}},X=function(){var e=b.parentNode,n=document.createElement("div");I=document.createElement("canvas"),x=I.getContext("2d"),A=document.createElement("div"),T=document.createElement("canvas"),n.width=I.width=b.width,n.height=I.height=b.height,A.style.minWidth=b.width+"px",n.className="jsgif",A.className="jsgif_toolbar",n.appendChild(I),n.appendChild(A),e.insertBefore(n,b),e.removeChild(b),t.c_w&&t.c_h&&U(t.c_w,t.c_h),K=!0},Z=function(){var e;return e=t.max_width&&o&&o.width>t.max_width?t.max_width/o.width:1},K=!1,Q=!1,Y=function(e){return d?!1:(Q=e?e:!1,d=!0,y=[],E(),c=null,f=null,g=null,p=null,!0)};return{play:j.play,pause:j.pause,move_relative:j.move_relative,move_to:j.move_to,get_playing:function(){return j.playing},get_canvas:function(){return I},get_canvas_scale:function(){return Z()},get_loading:function(){return d},get_auto_play:function(){return t.auto_play},get_frames:function(){return j.frames()},get_length:function(){return j.length()},get_current_frame:function(){return j.current_frame()},load_url:function(e,t){if(Y(t)){var a=new XMLHttpRequest;a.open("GET",e,!0),"overrideMimeType"in a?a.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in a?a.responseType="arraybuffer":a.setRequestHeader("Accept-Charset","x-user-defined"),a.onloadstart=function(){K||X()},a.onload=function(e){200!=this.status&&R("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var t=this.response;t.toString().indexOf("ArrayBuffer")>0&&(t=new Uint8Array(t)),i=new n(t),setTimeout(F,0)},a.onprogress=function(e){e.lengthComputable&&G(e.loaded,e.total,!0)},a.onerror=function(){R("xhr")},a.send()}},load:function(e){this.load_url(b.getAttribute("rel:animated_src")||b.src,e)},load_raw:function(e,t){Y(t)&&(K||X(),i=new n(e),setTimeout(F,0))},set_frame_offset:N}};return i});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e){"use strict";var t=e.SuperGif,n=e.btoa;e.__isNode&&(t=require("../libgif"),n=require("btoa"));var a=function(){function a(){_classCallCheck(this,a),this.isNode="undefined"==typeof window,this.q='"'}return _createClass(a,[{key:"convertDataURIToBinary",value:function(e){for(var t=";base64,",n=e.indexOf(t)+t.length,a=e.substring(n),r=window.atob(a),i=r.length,o=new Uint8Array(new ArrayBuffer(i)),s=0;i>s;s++)o[s]=r.charCodeAt(s);return o}},{key:"convertBinaryToBase64",value:function(e){for(var t,a=32768,r=0,i=e.length,o="";i>r;)t=e.subarray(r,Math.min(r+a,i)),o+=String.fromCharCode.apply(null,t),r+=a;return n(o)}},{key:"encodeSvgAsBase64",value:function(e){return"data:image/svg+xml;base64,"+n(e)}},{key:"wrapInSvgHeader",value:function(e,t,n){var a=this.q,r="<svg xmlns="+a+"http://www.w3.org/2000/svg"+a+" xmlns:A="+a+"http://www.w3.org/1999/xlink"+a+" width="+a+t+a+" height="+a+n+a+">",i="</svg>";return r+e+i}},{key:"smilSvgAnimationFromBase64Gif",value:function(e,t){return this.smilSvgAnimationFromImageDataGif(this.convertDataURIToBinary(e),t)}},{key:"smilSvgAnimationFromImageDataGif",value:function(e,n){var a=this,r=document.createElement("div"),i=document.createElement("img");r.appendChild(i);var o=t({gif:i,auto_play:!1,draw_while_loading:!1,show_progress_bar:!1});return o.load_raw(e,function(){var e=o.get_canvas(),t=o.get_frames(),r=[];r.width=e.width,r.height=e.height;for(var i=0;i<t.length;i++){var s=t[i];o.move_to(i);var d=e.toDataURL("image/png"),u=s.delay;u&&(u=10*u),r.push({imageDataUrl:d,delay:u})}var l=a.smilSvgAnimationFromWebFrames(r);n&&n(l)}),""}},{key:"cssSvgAnimationFromImageDataGif",value:function(e){var t=new omggif.GifReader(e),n=ImageInfo.fromGifReader(t);return this.cssSvgAnimationFromImageDataFramesGif(n)}},{key:"_encodeImageDataToPngCanvas",value:function(e){var t=window.document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.putImageData(e,0,0),t.toDataURL("image/png")}},{key:"_encodeImageDataToPngNodeJs",value:function(e){var t=require("pngjs").PNG,n=new t;n.width=e.width,n.height=e.height,n.data=new Buffer(e.data);var a=t.sync.write(n),r="data:image/png;base64,"+this.convertBinaryToBase64(a);return r}},{key:"encodeImageDataToPng",value:function(t){return e.__isNode?this._encodeImageDataToPngNodeJs(t):this._encodeImageDataToPngCanvas(t)}},{key:"generateImageId",value:function(e,t){return"F"+t}},{key:"generateAnimationId",value:function(e,t){return"A"+t}},{key:"cssSvgAnimationFromImageDataFramesGif",value:function(e){for(var t=(this.q,""),n="",a=0;a<e.frames.length;a++){var r=e.frames[a],i=(this.encodeImageDataToPng(r),this.generateImageId(e,a),"<image id=$ { q } $ { imageId } $ { q } height = $ { q } 100 % $ { q } width = $ { q } 0$ { q } A: href = $ { q } $ { pngImageDataUri } $ { q }/>"),o=(this.generateAnimationId(e,a),"");o+=0===a?" $ { this.generateAnimationId(imageData, imageData.frames.length - 1) }.end; 0s":" $ { this.generateAnimationId(imageData, i - 1) }.end;";var s="<set id=$ { q } $ { setTagId } $ { q } A: href = $ { q }# $ { imageId } $ { q } attributeName = $ { q } width$ { q } to = $ { q } 100 % $ { q } dur = $ { q } $ { frame.delay } ms$ { q } begin = $ { q } $ { begin } $ { q }/>";n+=s,t+=i}return t+=n,t=this.wrapInSvgHeader(t,e.width,e.height)}},{key:"smilSvgAnimationFromWebFrames",value:function(e){for(var t=this.q,n="",a="",r=0;r<e.length;r++){var i=e[r],o=i.imageDataUrl,s=this.generateImageId(i,r),d="<image id="+t+s+t+" height="+t+"100%"+t+" width="+t+"0"+t+" A:href="+t+o+t+"/>",u=this.generateAnimationId(i,r),l="";l+=0===r?this.generateAnimationId(i,e.length-1)+".end; 0s":this.generateAnimationId(i,r-1)+".end;";var h="<set id="+t+u+t+" A:href="+t+"#"+s+t+" attributeName="+t+"width"+t+" to="+t+"100%"+t+" dur="+t+i.delay+"ms"+t+" begin="+t+l+t+"/>";a+=h,n+=d}return n+=a,n=this.wrapInSvgHeader(n,e.width,e.height)}}]),a}();e.__isNode?module.exports=a:e.gif2asvg=a}("undefined"==typeof window?global:window),function(e){"use strict";var t;t=e.__isNode?require("./dist/gif2asvg"):e.gif2asvg,t.prototype.wrapInSvgHeader=function(e,t,n){var a=this.q,r='<svg id="ts0000000000000000" xmlns='+a+"http://www.w3.org/2000/svg"+a+" xmlns:A="+a+"http://www.w3.org/1999/xlink"+a+" width="+a+t+a+" height="+a+n+a+">",i="</svg>";return r+e+i}}("undefined"==typeof window?global:window);
//# sourceMappingURL=gif2asvg.full.min.js.map
