function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e){"use strict";e.__isNode="undefined"==typeof window}("undefined"==typeof window?global:window),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SuperGif=t()}(this,function(){var e=function(e){return e.reduce(function(e,t){return 2*e+t},0)},t=function(e){for(var t=[],n=7;n>=0;n--)t.push(!!(e&1<<n));return t},n=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],n=0;e>n;n++)t.push(this.readByte());return t},this.read=function(e){for(var t="",n=0;e>n;n++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},r=function(e,t){for(var n,r,i=0,a=function(e){for(var n=0,r=0;e>r;r++)t.charCodeAt(i>>3)&1<<(7&i)&&(n|=1<<r),i++;return n},o=[],s=1<<e,l=s+1,u=e+1,d=[],c=function(){d=[],u=e+1;for(var t=0;s>t;t++)d[t]=[t];d[s]=[],d[l]=null};;)if(r=n,n=a(u),n!==s){if(n===l)break;if(n<d.length)r!==s&&d.push(d[r].concat(d[n][0]));else{if(n!==d.length)throw new Error("Invalid LZW code.");d.push(d[r].concat(d[r][0]))}o.push.apply(o,d[n]),d.length===1<<u&&12>u&&u++}else c();return o},i=function(n,i){i||(i={});var a=function(e){for(var t=[],r=0;e>r;r++)t.push(n.readBytes(3));return t},o=function(){var e,t;t="";do e=n.readByte(),t+=n.read(e);while(0!==e);return t},s=function(){var r={};if(r.sig=n.read(3),r.ver=n.read(3),"GIF"!==r.sig)throw new Error("Not a GIF file.");r.width=n.readUnsigned(),r.height=n.readUnsigned();var o=t(n.readByte());r.gctFlag=o.shift(),r.colorRes=e(o.splice(0,3)),r.sorted=o.shift(),r.gctSize=e(o.splice(0,3)),r.bgColor=n.readByte(),r.pixelAspectRatio=n.readByte(),r.gctFlag&&(r.gct=a(1<<r.gctSize+1)),i.hdr&&i.hdr(r)},l=function(r){var a=function(r){var a=(n.readByte(),t(n.readByte()));r.reserved=a.splice(0,3),r.disposalMethod=e(a.splice(0,3)),r.userInput=a.shift(),r.transparencyGiven=a.shift(),r.delayTime=n.readUnsigned(),r.transparencyIndex=n.readByte(),r.terminator=n.readByte(),i.gce&&i.gce(r)},s=function(e){e.comment=o(),i.com&&i.com(e)},l=function(e){n.readByte();e.ptHeader=n.readBytes(12),e.ptData=o(),i.pte&&i.pte(e)},u=function(e){{var t=function(e){n.readByte();e.unknown=n.readByte(),e.iterations=n.readUnsigned(),e.terminator=n.readByte(),i.app&&i.app.NETSCAPE&&i.app.NETSCAPE(e)},r=function(e){e.appData=o(),i.app&&i.app[e.identifier]&&i.app[e.identifier](e)};n.readByte()}switch(e.identifier=n.read(8),e.authCode=n.read(3),e.identifier){case"NETSCAPE":t(e);break;default:r(e)}},d=function(e){e.data=o(),i.unknown&&i.unknown(e)};switch(r.label=n.readByte(),r.label){case 249:r.extType="gce",a(r);break;case 254:r.extType="com",s(r);break;case 1:r.extType="pte",l(r);break;case 255:r.extType="app",u(r);break;default:r.extType="unknown",d(r)}},u=function(s){var l=function(e,t){for(var n=new Array(e.length),r=e.length/t,i=function(r,i){var a=e.slice(i*t,(i+1)*t);n.splice.apply(n,[r*t,t].concat(a))},a=[0,4,2,1],o=[8,8,4,2],s=0,l=0;4>l;l++)for(var u=a[l];r>u;u+=o[l])i(u,s),s++;return n};s.leftPos=n.readUnsigned(),s.topPos=n.readUnsigned(),s.width=n.readUnsigned(),s.height=n.readUnsigned();var u=t(n.readByte());s.lctFlag=u.shift(),s.interlaced=u.shift(),s.sorted=u.shift(),s.reserved=u.splice(0,2),s.lctSize=e(u.splice(0,3)),s.lctFlag&&(s.lct=a(1<<s.lctSize+1)),s.lzwMinCodeSize=n.readByte();var d=o();s.pixels=r(s.lzwMinCodeSize,d),s.interlaced&&(s.pixels=l(s.pixels,s.width)),i.img&&i.img(s)},d=function(){var e={};switch(e.sentinel=n.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",l(e);break;case",":e.type="img",u(e);break;case";":e.type="eof",i.eof&&i.eof(e);break;default:throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}"eof"!==e.type&&setTimeout(d,0)},c=function(){s(),setTimeout(d,0)};c()},a=function(e){var t={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var r in e)t[r]=e[r];t.vp_w&&t.vp_h&&(t.is_vp=!0);var a,o,s=null,l=!1,u=null,d=null,c=null,h=null,f=null,g=null,p=null,v=!0,m=!0,y=!1,w=[],_=[],b=t.gif;"undefined"==typeof t.auto_play&&(t.auto_play=!b.getAttribute("rel:auto_play")||"1"==b.getAttribute("rel:auto_play"));var x,A,k,C,I=t.hasOwnProperty("on_end")?t.on_end:null,T=t.hasOwnProperty("loop_delay")?t.loop_delay:0,S=t.hasOwnProperty("loop_mode")?t.loop_mode:"auto",B=t.hasOwnProperty("draw_while_loading")?t.draw_while_loading:!0,P=B?t.hasOwnProperty("show_progress_bar")?t.show_progress_bar:!0:!1,F=t.hasOwnProperty("progressbar_height")?t.progressbar_height:25,D=t.hasOwnProperty("progressbar_background_color")?t.progressbar_background_color:"rgba(255,255,255,0.4)",E=t.hasOwnProperty("progressbar_foreground_color")?t.progressbar_foreground_color:"rgba(255,0,22,.8)",U=function(){u=null,d=null,f=c,c=null,g=null},N=function(){try{i(a,V)}catch(e){z("parse")}},G=function(e,t){x.width=e*Z(),x.height=t*Z(),k.style.minWidth=e*Z()+"px",C.width=e,C.height=t,C.style.width=e+"px",C.style.height=t+"px",C.getContext("2d").setTransform(1,0,0,1,0,0)},R=function(e,t){return _[e]?("undefined"!=typeof t.x&&(_[e].x=t.x),void("undefined"!=typeof t.y&&(_[e].y=t.y))):void(_[e]=t)},O=function(e,n,r){if(r&&P){var i,a,o,s,l=F;if(t.is_vp){y?(o=(t.vp_t+t.vp_h-l)/Z(),l/=Z(),i=t.vp_l/Z(),a=i+e/n*(t.vp_w/Z()),s=x.width/Z()):(o=t.vp_t+t.vp_h-l,l=l,i=t.vp_l,a=i+e/n*t.vp_w,s=x.width)}else o=(x.height-l)/(y?Z():1),a=e/n*x.width/(y?Z():1),s=x.width/(y?Z():1),l/=y?Z():1;A.fillStyle=D,A.fillRect(a,o,s-a,l),A.fillStyle=E,A.fillRect(0,o,a,l)}},z=function(e){var n=function(){A.fillStyle="black",A.fillRect(0,0,t.c_w?t.c_w:o.width,t.c_h?t.c_h:o.height),A.strokeStyle="red",A.lineWidth=3,A.moveTo(0,0),A.lineTo(t.c_w?t.c_w:o.width,t.c_h?t.c_h:o.height),A.moveTo(0,t.c_h?t.c_h:o.height),A.lineTo(t.c_w?t.c_w:o.width,0),A.stroke()};s=e,o={width:b.width,height:b.height},w=[],n()},W=function(e){o=e,G(o.width,o.height)},q=function(e){M(),U(),u=e.transparencyGiven?e.transparencyIndex:null,d=e.delayTime,c=e.disposalMethod},M=function(){g&&(w.push({data:g.getImageData(0,0,o.width,o.height),delay:d}),_.push({x:0,y:0}))},H=function(e){g||(g=C.getContext("2d"));var n=w.length,r=e.lctFlag?e.lct:o.gct;n>0&&(3===f?null!==h?g.putImageData(w[h].data,0,0):g.clearRect(p.leftPos,p.topPos,p.width,p.height):h=n-1,2===f&&g.clearRect(p.leftPos,p.topPos,p.width,p.height));var i=g.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(function(e,t){e!==u&&(i.data[4*t+0]=r[e][0],i.data[4*t+1]=r[e][1],i.data[4*t+2]=r[e][2],i.data[4*t+3]=255)}),g.putImageData(i,e.leftPos,e.topPos),y||(A.scale(Z(),Z()),y=!0),B&&(A.drawImage(C,0,0),B=t.auto_play),p=e},j=function(){var e=-1,n=0,r=function(){var t=m?1:-1;return(e+t+w.length)%w.length},i=function(t){e+=t,o()},a=function(){var t=!1,a=function(){null!==I&&I(b),n++,S!==!1||0>n?o():(t=!1,v=!1)},o=function(){if(t=v){i(1);var n=10*w[e].delay;n||(n=100);var s=r();0===s?(n+=T,setTimeout(a,n)):setTimeout(o,n)}};return function(){t||setTimeout(o,0)}}(),o=function(){var t;e=parseInt(e,10),e>w.length-1&&(e=0),0>e&&(e=0),t=_[e],C.getContext("2d").putImageData(w[e].data,t.x,t.y),A.globalCompositeOperation="copy",A.drawImage(C,0,0)},l=function(){v=!0,a()},u=function(){v=!1};return{init:function(){s||(t.c_w&&t.c_h||A.scale(Z(),Z()),t.auto_play?a():(e=0,o()))},step:a,play:l,pause:u,playing:v,move_relative:i,current_frame:function(){return e},frames:function(){return w},length:function(){return w.length},move_to:function(t){e=t,o()}}}(),K=function(e){O(a.pos,a.data.length,e)},L=function(){},J=function(e,t){return function(n){e(n),K(t)}},V={hdr:J(W),gce:J(q),com:J(L),app:{NETSCAPE:J(L)},img:J(H,!0),eof:function(e){M(),K(!1),t.c_w&&t.c_h||(x.width=o.width*Z(),x.height=o.height*Z()),j.init(),l=!1,Y&&Y(b)}},X=function(){var e=b.parentNode,n=document.createElement("div");x=document.createElement("canvas"),A=x.getContext("2d"),k=document.createElement("div"),C=document.createElement("canvas"),n.width=x.width=b.width,n.height=x.height=b.height,k.style.minWidth=b.width+"px",n.className="jsgif",k.className="jsgif_toolbar",n.appendChild(x),n.appendChild(k),e.insertBefore(n,b),e.removeChild(b),t.c_w&&t.c_h&&G(t.c_w,t.c_h),Q=!0},Z=function(){var e;return e=t.max_width&&o&&o.width>t.max_width?t.max_width/o.width:1},Q=!1,Y=!1,$=function(e){return l?!1:(Y=e?e:!1,l=!0,w=[],U(),h=null,f=null,g=null,p=null,!0)};return{play:j.play,pause:j.pause,move_relative:j.move_relative,move_to:j.move_to,get_playing:function(){return j.playing},get_canvas:function(){return x},get_canvas_scale:function(){return Z()},get_loading:function(){return l},get_auto_play:function(){return t.auto_play},get_frames:function(){return j.frames()},get_length:function(){return j.length()},get_current_frame:function(){return j.current_frame()},load_url:function(e,t){if($(t)){var r=new XMLHttpRequest;r.open("GET",e,!0),"overrideMimeType"in r?r.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in r?r.responseType="arraybuffer":r.setRequestHeader("Accept-Charset","x-user-defined"),r.onloadstart=function(){Q||X()},r.onload=function(e){200!=this.status&&z("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var t=this.response;t.toString().indexOf("ArrayBuffer")>0&&(t=new Uint8Array(t)),a=new n(t),setTimeout(N,0)},r.onprogress=function(e){e.lengthComputable&&O(e.loaded,e.total,!0)},r.onerror=function(){z("xhr")},r.send()}},load:function(e){this.load_url(b.getAttribute("rel:animated_src")||b.src,e)},load_raw:function(e,t){$(t)&&(Q||X(),a=new n(e),setTimeout(N,0))},set_frame_offset:R}};return a});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e){"use strict";var t=e.SuperGif,n=e.btoa;e.__isNode&&(t=require("../libgif"),n=require("btoa"));var r=function(){function r(){_classCallCheck(this,r),this.isNode="undefined"==typeof window,this.q='"'}return _createClass(r,[{key:"convertDataURIToBinary",value:function(e){for(var t=";base64,",n=e.indexOf(t)+t.length,r=e.substring(n),i=window.atob(r),a=i.length,o=new Uint8Array(new ArrayBuffer(a)),s=0;a>s;s++)o[s]=i.charCodeAt(s);return o}},{key:"convertBinaryToBase64",value:function(e){for(var t,r=32768,i=0,a=e.length,o="";a>i;)t=e.subarray(i,Math.min(i+r,a)),o+=String.fromCharCode.apply(null,t),i+=r;return n(o)}},{key:"encodeSvgAsBase64",value:function(e){return"data:image/svg+xml;base64,"+n(e)}},{key:"wrapInSvgHeader",value:function(e,t,n){var r=this.q,i="<svg xmlns="+r+"http://www.w3.org/2000/svg"+r+" xmlns:A="+r+"http://www.w3.org/1999/xlink"+r+" width="+r+t+r+" height="+r+n+r+">",a="</svg>";return i+e+a}},{key:"_getWebFrames",value:function(e,n){var r=document.createElement("div"),i=document.createElement("img");r.appendChild(i);var a=t({gif:i,auto_play:!1,draw_while_loading:!1,show_progress_bar:!1});a.load_raw(e,function(){var e=a.get_canvas(),t=a.get_frames(),r=[];r.width=e.width,r.height=e.height,r.duration=0;for(var i=0;i<t.length;i++){var o=t[i];a.move_to(i);var s=e.toDataURL("image/png"),l=o.delay;l&&(l=10*l),r.duration+=l,r.push({imageDataUrl:s,delay:l})}n&&n(r)})}},{key:"smilSvgAnimationFromBase64Gif",value:function(e,t){return this.smilSvgAnimationFromImageDataGif(this.convertDataURIToBinary(e),t)}},{key:"smilSvgAnimationFromImageDataGif",value:function(e,t){var n=this;return this._getWebFrames(e,function(e){var r=n.smilSvgAnimationFromWebFrames(e);t&&t(r)}),""}},{key:"cssSvgAnimationFromBase64Gif",value:function(e,t){return this.cssSvgAnimationFromImageDataGif(this.convertDataURIToBinary(e),t)}},{key:"cssSvgAnimationFromImageDataGif",value:function(e,t){var n=this;return this._getWebFrames(e,function(e){var r=n.cssSvgAnimationFromWebFrames(e);t&&t(r)}),""}},{key:"encodeImageDataToPng",value:function(t){return e.__isNode?this._encodeImageDataToPngNodeJs(t):this._encodeImageDataToPngCanvas(t)}},{key:"generateImageId",value:function(e,t){return"F"+t}},{key:"generateAnimationId",value:function(e,t){return"A"+t}},{key:"_normalizeKeyFramePercentage",value:function(e){return e}},{key:"cssSvgAnimationFromWebFrames",value:function(e){for(var t=this.q,n=0,r="",i='<style type="text/css"><![CDATA[',a=e.duration,o=0,s=0;s<e.length;s++){var l=e[s],u=l.imageDataUrl,d=this.generateAnimationId(l,s),c=this.generateImageId(l,s),h="<image id="+t+c+t+" transform="+t+"matrix(1,0,0,1,0,0)"+t+" height="+t+"100%"+t+" width="+t+"100%"+t+" A:href="+t+u+t+"/>",f="\n@keyframes "+d+" { ";if(0===s)f+="0% {visibility: visible;}";else{f+="0% {visibility: hidden;}";var g=o/a*100;g=this._normalizeKeyFramePercentage(g),f+=g+"% {visibility: visible;}"}o+=l.delay;var p=o/a*100;p=this._normalizeKeyFramePercentage(p),f+=p+"% {visibility: hidden;}",f+=" }",i+=f;var v="hidden";s===n&&(v="visible");var m="\n"+c+" {visibility: "+v+"; animation-name: "+d+";animation-duration: "+a+"ms;animation-iteration-count: infinite;}";i+=m,r+=h}return i+="]]></style>",r=i+r,r=this.wrapInSvgHeader(r,e.width,e.height)}},{key:"smilSvgAnimationFromWebFrames",value:function(e){for(var t=this.q,n="",r="",i=0;i<e.length;i++){var a=e[i],o=a.imageDataUrl,s=this.generateImageId(a,i),l="<image id="+t+s+t+" height="+t+"100%"+t+" width="+t+"0"+t+" A:href="+t+o+t+"/>",u=this.generateAnimationId(a,i),d="";d+=0===i?this.generateAnimationId(a,e.length-1)+".end; 0s":this.generateAnimationId(a,i-1)+".end;";var c="<set id="+t+u+t+" A:href="+t+"#"+s+t+" attributeName="+t+"width"+t+" to="+t+"100%"+t+" dur="+t+a.delay+"ms"+t+" begin="+t+d+t+"/>";r+=c,n+=l}return n+=r,n=this.wrapInSvgHeader(n,e.width,e.height)}}]),r}();e.__isNode?module.exports=r:e.gif2asvg=r}("undefined"==typeof window?global:window),function(e){"use strict";var t;t=e.__isNode?require("./dist/gif2asvg"):e.gif2asvg,t.prototype.wrapInSvgHeader=function(e,t,n){var r=this.q,i='<svg id="ts0000000000000000" xmlns='+r+"http://www.w3.org/2000/svg"+r+" xmlns:A="+r+"http://www.w3.org/1999/xlink"+r+" width="+r+t+r+" height="+r+n+r+">",a="</svg>";return i+e+a}}("undefined"==typeof window?global:window);
//# sourceMappingURL=gif2asvg.full.min.js.map
