function GifWriter(e,a,t,r){function n(e){var a=e.length;if(2>a||a>256||a&a-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return a}var i=0,r=void 0===r?{}:r,o=void 0===r.loop?null:r.loop,f=void 0===r.palette?null:r.palette;if(0>=a||0>=t||a>65535||t>65535)throw"Width/Height invalid.";e[i++]=71,e[i++]=73,e[i++]=70,e[i++]=56,e[i++]=57,e[i++]=97;var d=0,l=0;if(null!==f){for(var s=n(f);s>>=1;)++d;if(s=1<<d,--d,void 0!==r.background){if(l=r.background,l>=s)throw"Background index out of range.";if(0===l)throw"Background index explicitly passed as 0."}}if(e[i++]=255&a,e[i++]=a>>8&255,e[i++]=255&t,e[i++]=t>>8&255,e[i++]=(null!==f?128:0)|d,e[i++]=l,e[i++]=0,null!==f)for(var u=0,g=f.length;g>u;++u){var h=f[u];e[i++]=h>>16&255,e[i++]=h>>8&255,e[i++]=255&h}if(null!==o){if(0>o||o>65535)throw"Loop count invalid.";e[i++]=33,e[i++]=255,e[i++]=11,e[i++]=78,e[i++]=69,e[i++]=84,e[i++]=83,e[i++]=67,e[i++]=65,e[i++]=80,e[i++]=69,e[i++]=50,e[i++]=46,e[i++]=48,e[i++]=3,e[i++]=1,e[i++]=255&o,e[i++]=o>>8&255,e[i++]=0}var v=!1;this.addFrame=function(a,t,r,o,d,l){if(v===!0&&(--i,v=!1),l=void 0===l?{}:l,0>a||0>t||a>65535||t>65535)throw"x/y invalid.";if(0>=r||0>=o||r>65535||o>65535)throw"Width/Height invalid.";if(d.length<r*o)throw"Not enough pixels for the frame size.";var s=!0,u=l.palette;if((void 0===u||null===u)&&(s=!1,u=f),void 0===u||null===u)throw"Must supply either a local or global palette.";for(var g=n(u),h=0;g>>=1;)++h;g=1<<h;var c=void 0===l.delay?0:l.delay,m=void 0===l.disposal?0:l.disposal;if(0>m||m>3)throw"Disposal out of range.";var w=!1,p=0;if(void 0!==l.transparent&&null!==l.transparent&&(w=!0,p=l.transparent,0>p||p>=g))throw"Transparent color index.";if((0!==m||w||0!==c)&&(e[i++]=33,e[i++]=249,e[i++]=4,e[i++]=m<<2|(w===!0?1:0),e[i++]=255&c,e[i++]=c>>8&255,e[i++]=p,e[i++]=0),e[i++]=44,e[i++]=255&a,e[i++]=a>>8&255,e[i++]=255&t,e[i++]=t>>8&255,e[i++]=255&r,e[i++]=r>>8&255,e[i++]=255&o,e[i++]=o>>8&255,e[i++]=s===!0?128|h-1:0,s===!0)for(var I=0,y=u.length;y>I;++I){var x=u[I];e[i++]=x>>16&255,e[i++]=x>>8&255,e[i++]=255&x}i=GifWriterOutputLZWCodeStream(e,i,2>h?2:h,d)},this.end=function(){return v===!1&&(e[i++]=59,v=!0),i}}function GifWriterOutputLZWCodeStream(e,a,t,r){function n(t){for(;g>=t;)e[a++]=255&h,h>>=8,g-=8,a===o+256&&(e[o]=255,o=a++)}function i(e){h|=e<<g,g+=u,n(8)}e[a++]=t;var o=a++,f=1<<t,d=f-1,l=f+1,s=l+1,u=t+1,g=0,h=0,v=r[0]&d,c={};i(f);for(var m=1,w=r.length;w>m;++m){var p=r[m]&d,I=v<<8|p,y=c[I];if(void 0===y){for(h|=v<<g,g+=u;g>=8;)e[a++]=255&h,h>>=8,g-=8,a===o+256&&(e[o]=255,o=a++);4096===s?(i(f),s=l+1,u=t+1,c={}):(s>=1<<u&&++u,c[I]=s++),v=p}else v=y}return i(v),i(l),n(1),o+1===a?e[o]=0:(e[o]=a-o-1,e[a++]=0),a}function GifReader(e){var a=0;if(71!==e[a++]||73!==e[a++]||70!==e[a++]||56!==e[a++]||56!==(e[a++]+1&253)||97!==e[a++])throw"Invalid GIF 87a/89a header.";{var t=e[a++]|e[a++]<<8,r=e[a++]|e[a++]<<8,n=e[a++],i=n>>7,o=7&n,f=1<<o+1;e[a++]}e[a++];var d=null;i&&(d=a,a+=3*f);var l=!0,s=[],u=0,g=null,h=0,v=null;for(this.width=t,this.height=r;l&&a<e.length;)switch(e[a++]){case 33:switch(e[a++]){case 255:if(11!==e[a]||78==e[a+1]&&69==e[a+2]&&84==e[a+3]&&83==e[a+4]&&67==e[a+5]&&65==e[a+6]&&80==e[a+7]&&69==e[a+8]&&50==e[a+9]&&46==e[a+10]&&48==e[a+11]&&3==e[a+12]&&1==e[a+13]&&0==e[a+16])a+=14,v=e[a++]|e[a++]<<8,a++;else for(a+=12;;){var c=e[a++];if(0===c)break;a+=c}break;case 249:if(4!==e[a++]||0!==e[a+4])throw"Invalid graphics extension block.";var m=e[a++];u=e[a++]|e[a++]<<8,g=e[a++],0===(1&m)&&(g=null),h=m>>2&7,a++;break;case 254:for(;;){var c=e[a++];if(0===c)break;a+=c}break;default:throw"Unknown graphic control label: 0x"+e[a-1].toString(16)}break;case 44:var w=e[a++]|e[a++]<<8,p=e[a++]|e[a++]<<8,I=e[a++]|e[a++]<<8,y=e[a++]|e[a++]<<8,x=e[a++],b=x>>7,A=x>>6&1,G=7&x,_=1<<G+1,k=d,B=!1;if(b){var B=!0;k=a,a+=3*_}var D=a;for(a++;;){var c=e[a++];if(0===c)break;a+=c}s.push({x:w,y:p,width:I,height:y,has_local_palette:B,palette_offset:k,data_offset:D,data_length:a-D,transparent_index:g,interlaced:!!A,delay:u,disposal:h});break;case 59:l=!1;break;default:throw"Unknown gif block: 0x"+e[a-1].toString(16)}this.numFrames=function(){return s.length},this.loopCount=function(){return v},this.frameInfo=function(e){if(0>e||e>=s.length)throw"Frame index out of range.";return s[e]},this.decodeAndBlitFrameBGRA=function(a,r){var n=this.frameInfo(a),i=n.width*n.height,o=new Uint8Array(i);GifReaderLZWOutputIndexStream(e,n.data_offset,o,i);var f=n.palette_offset,d=n.transparent_index;null===d&&(d=256);var l=n.width,s=t-l,u=l,g=4*(n.y*t+n.x),h=4*((n.y+n.height)*t+n.x),v=g,c=4*s;n.interlaced===!0&&(c+=4*t*7);for(var m=8,w=0,p=o.length;p>w;++w){var I=o[w];if(0===u&&(v+=c,u=l,v>=h&&(c=4*s+4*t*(m-1),v=g+(l+s)*(m<<1),m>>=1)),I===d)v+=4;else{var y=e[f+3*I],x=e[f+3*I+1],b=e[f+3*I+2];r[v++]=b,r[v++]=x,r[v++]=y,r[v++]=255}--u}},this.decodeAndBlitFrameRGBA=function(a,r){var n=this.frameInfo(a),i=n.width*n.height,o=new Uint8Array(i);GifReaderLZWOutputIndexStream(e,n.data_offset,o,i);var f=n.palette_offset,d=n.transparent_index;null===d&&(d=256);var l=n.width,s=t-l,u=l,g=4*(n.y*t+n.x),h=4*((n.y+n.height)*t+n.x),v=g,c=4*s;n.interlaced===!0&&(c+=4*t*7);for(var m=8,w=0,p=o.length;p>w;++w){var I=o[w];if(0===u&&(v+=c,u=l,v>=h&&(c=4*s+4*t*(m-1),v=g+(l+s)*(m<<1),m>>=1)),I===d)v+=4;else{var y=e[f+3*I],x=e[f+3*I+1],b=e[f+3*I+2];r[v++]=y,r[v++]=x,r[v++]=b,r[v++]=255}--u}}}function GifReaderLZWOutputIndexStream(e,a,t,r){for(var n=e[a++],i=1<<n,o=i+1,f=o+1,d=n+1,l=(1<<d)-1,s=0,u=0,g=0,h=e[a++],v=new Int32Array(4096),c=null;;){for(;16>s&&0!==h;)u|=e[a++]<<s,s+=8,1===h?h=e[a++]:--h;if(d>s)break;var m=u&l;if(u>>=d,s-=d,m!==i){if(m===o)break;for(var w=f>m?m:c,p=0,I=w;I>i;)I=v[I]>>8,++p;var y=I,x=g+p+(w!==m?1:0);if(x>r)return void console.log("Warning, gif stream longer than expected.");t[g++]=y,g+=p;var b=g;for(w!==m&&(t[g++]=y),I=w;p--;)I=v[I],t[--b]=255&I,I>>=8;null!==c&&4096>f&&(v[f++]=c<<8|y,f>=l+1&&12>d&&(++d,l=l<<1|1)),c=m}else f=o+1,d=n+1,l=(1<<d)-1,c=null}return g!==r&&console.log("Warning, gif stream shorter than expected."),t}try{exports.GifWriter=GifWriter,exports.GifReader=GifReader}catch(e){}!function(e){"use strict";var a={};a.isNode="undefined"==typeof window,a.isNode?module.exports=a:e.ImageInfo=a,a.createImageData=function(e,t){if(a.isNode){var r=Uint8ClampedArray||Uint8Array,n={width:e,height:t};return n.data=new r(e*t*4),n}var i=window.document.createElement("canvas").getContext("2d");return i.createImageData(e,t)},a.fromGifReader=function(e){var t=a.createImageData(e.width,e.height);t.frames=[];for(var r=0;r<e.numFrames();r++){var n=e.frameInfo(r),i=n.width,o=n.height,f=a.createImageData(i,o);f.data_length=n.data_length,f.data_offset=n.data_offset,f.delay=n.delay,f.disposal=n.disposal,f.has_local_palette=n.has_local_palette,f.interlaced=n.interlaced,f.palette_offset=n.palette_offset,f.transparent_index=n.transparent_index,f.x=n.x,f.y=n.y,e.decodeAndBlitFrameRGBA(r,f.data),t.frames[r]=f,f.delay&&(f.delay=10*f.delay)}return t.loopCount=e.loopCount(),t.loopCount||(t.loopCount=-1),t}}("undefined"==typeof window?global:window),function(e){"use strict";var a={};if(a.isNode="undefined"==typeof window,a.isNode){var t=require("omggif"),r=require("./image-info");module.exports=a}else{var t={GifWriter:e.GifWriter,GifReader:e.GifReader},r=e.ImageInfo;e.gif2asvg=a}a.isNode&&"undefined"==typeof btoa&&(e.btoa=function(e){var a;return a=e instanceof Buffer?e:new Buffer(e.toString(),"binary"),a.toString("base64")}),a.convertDataURIToBinary=function(e){for(var a=";base64,",t=e.indexOf(a)+a.length,r=e.substring(t),n=window.atob(r),i=n.length,o=new Uint8Array(new ArrayBuffer(i)),f=0;i>f;f++)o[f]=n.charCodeAt(f);return o},a.convertBinaryToBase64=function(e){for(var a,t=32768,r=0,n=e.length,i="";n>r;)a=e.subarray(r,Math.min(r+t,n)),i+=String.fromCharCode.apply(null,a),r+=t;return btoa(i)},a.encodeSvgAsBase64=function(e){return"data:image/svg+xml;base64,"+btoa(e)},a.wrapInSvgHeader=function(e,a,t){var r='<svg xmlns="http://www.w3.org/2000/svg" xmlns:A="http://www.w3.org/1999/xlink" width="'+a+'" height="'+t+'">',n="</svg>";return r+e+n},a.smilSvgAnimationFromBase64Gif=function(e){return a.smilSvgAnimationFromImageDataGif(a.convertDataURIToBinary(e))},a.smilSvgAnimationFromImageDataGif=function(e){var n=new t.GifReader(e),i=r.fromGifReader(n);return a.smilSvgAnimationFromImageDataFramesGif(i)},a._encodeImageDataToPngCanvas=function(e){var a=window.document.createElement("canvas");a.width=e.width,a.height=e.height;var t=a.getContext("2d");return t.putImageData(e,0,0),a.toDataURL("image/png")},a._encodeImageDataToPngNodeJs=function(e){var t=require("pngjs").PNG,r=new t;r.width=e.width,r.height=e.height,r.data=new Buffer(e.data);var n=t.sync.write(r),i="data:image/png;base64,"+a.convertBinaryToBase64(n);return i},a.encodeImageDataToPng=function(e){return a.isNode?a._encodeImageDataToPngNodeJs(e):a._encodeImageDataToPngCanvas(e)},a.generateImageId=function(e,a){return"F"+a},a.generateAnimationId=function(e,a){return"A"+a},a.smilSvgAnimationFromImageDataFramesGif=function(e){for(var t="",r="",n=0;n<e.frames.length;n++){var i=e.frames[n],o=a.encodeImageDataToPng(i),f=a.generateImageId(e,n),d='<image id="'+f+'" height="100%" width="0" A:href="'+o+'"/>',l=a.generateAnimationId(e,n),s="";s+=0===n?a.generateAnimationId(e,e.frames.length-1)+".end; 0s":a.generateAnimationId(e,n-1)+".end;";var u='<set id="'+l+'" A:href="#'+f+'" attributeName="width" to="100%" dur="'+i.delay+'ms" begin="'+s+'"/>';r+=u,t+=d}return t+=r,t=a.wrapInSvgHeader(t,e.width,e.height)}}("undefined"==typeof window?global:window);